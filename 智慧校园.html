<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è¥¿å—æ—ä¸šå¤§å­¦æ™ºæ…§æ ¡å›­åœ°å›¾</title>
  
  <style>
    /* ===== åŸºç¡€æ ·å¼ ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      font-family: "Microsoft YaHei", Arial, sans-serif;
      overflow: hidden;
    }
    
    #container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    /* ===== åŠ è½½åŠ¨ç”» ===== */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.3s ease;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #009688;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ===== ä¾§è¾¹æ  ===== */
    .sidebar {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 300px;
      max-width: 90%;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      z-index: 10;
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .sidebar h3 {
      color: #009688;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .spot-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .spot-item:hover {
      background-color: #f9f9f9;
    }
    
    .spot-item strong {
      color: #333;
      font-size: 14px;
    }
    
    .spot-item p {
      font-size: 12px;
      color: #666;
      margin: 4px 0 0 0;
      line-height: 1.4;
    }
    
    /* ===== åº•éƒ¨å·¥å…·æ  ===== */
    .route-tool {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 99;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 15px;
      border-radius: 10px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(5px);
    }
    
    .route-btn {
      padding: 8px 16px;
      background: #009688;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .route-btn:hover {
      background: #00796b;
      transform: translateY(-1px);
    }
    
    .route-btn.active {
      background: #005b52;
      box-shadow: 0 2px 5px rgba(0, 91, 82, 0.3);
    }
    
    .plan-switch-btn {
      padding: 8px 16px;
      background: #cccccc;
      color: #333333;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      font-weight: bold;
    }
    
    .plan-switch-btn.open {
      background: #009688;
      color: #ffffff;
    }
    
    .clear-btn {
      padding: 8px 16px;
      background: #ffffff;
      color: #009688;
      border: 1px solid #009688;
      border-radius: 6px;
      cursor: pointer;
	font-size: 13px;
      transition: all 0.2s;
    }
    
    .clear-btn:hover {
      background: #f0f9f8;
    }
    
    /* ===== è·¯å¾„è§„åˆ’æç¤ºæ¡† æ ¸å¿ƒä¼˜åŒ–ï¼šè°ƒæ•´ä½ç½®é¿å…é®æŒ¡å³ä¾§æ’ä»¶ ===== */
    .plan-tips {
      position: absolute;
      top: 20px;
      left: 340px;
      z-index: 98;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 12px 18px;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      line-height: 1.6;
      max-width: 360px;
      border-left: 4px solid #009688;
      backdrop-filter: blur(5px);
      max-width: calc(100% - 360px);
    }
    
    /* ===== å“åº”å¼è®¾è®¡ è¡¥å……ä¼˜åŒ–ï¼šå°å±å¹•ä¸‹æç¤ºæ¡†è‡ªé€‚åº” ===== */
    @media (max-width: 1200px) {
      .plan-tips {
        left: 220px;
        max-width: calc(100% - 240px);
      }
    }
    
    @media (max-width: 768px) {
      .sidebar {
        width: calc(100% - 40px);
        max-height: 200px;
      }
      
      .route-tool {
        width: calc(100% - 40px);
        justify-content: center;
      }
      
      .plan-tips {
        left: 50%;
        top: 10px;
        transform: translateX(-50%);
        max-width: calc(100% - 40px);
        font-size: 13px;
        padding: 10px 14px;
      }
      
      .route-btn,
      .plan-switch-btn,
      .clear-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
    
    @media (max-width: 480px) {
      .route-tool {
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }
      
      .route-btn,
      .plan-switch-btn,
      .clear-btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <!-- åŠ è½½é®ç½© -->
  <div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>æ­£åœ¨åŠ è½½æ ¡å›­åœ°å›¾...</p>
  </div>

  <!-- è·¯å¾„è§„åˆ’çŠ¶æ€æç¤º -->
  <div class="plan-tips" id="planTips">
    âœ… è·¯å¾„è§„åˆ’åŠŸèƒ½å·²å…³é—­ï¼Œç‚¹å‡»åº•éƒ¨ã€å¼€å¯è·¯å¾„è§„åˆ’ã€‘æŒ‰é’®å³å¯ä½¿ç”¨è·¯çº¿è§„åˆ’
  </div>
  
  <!-- ä¾§è¾¹æ  -->
  <div class="sidebar" id="sidebar">
    <h3>è¥¿å—æ—ä¸šå¤§å­¦æ™ºæ…§æ ¡å›­</h3>
    <p id="campus-intro"></p>
    <div id="spot-list" style="margin-top: 15px;"></div>
  </div>
  
  <!-- åœ°å›¾å®¹å™¨ -->
  <div id="container"></div>

  <!-- åº•éƒ¨å·¥å…·æ  âœ…ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ­¥è¡Œå’Œé©¾é©¶æŒ‰é’®ä½ç½®è°ƒæ¢ é¡ºåºï¼šé©¾è½¦ â†’ éª‘è¡Œ â†’ æ­¥è¡Œ -->
  <div class="route-tool">
    <button class="plan-switch-btn" id="planSwitch">å¼€å¯è·¯å¾„è§„åˆ’</button>
    <button class="route-btn active" data-type="drive">é©¾è½¦</button>
    <button class="route-btn" data-type="ride">éª‘è¡Œ</button>
    <button class="route-btn" data-type="walk">æ­¥è¡Œ</button>
    <button class="clear-btn" id="clearRoute">æ¸…ç©ºè·¯çº¿</button>
  </div>

  <!-- é«˜å¾·åœ°å›¾å®‰å…¨é…ç½® -->
  <script type="text/javascript">
    window._AMapSecurityConfig = {
      securityJsCode: "50f177b3ea427e38fc9eaa98d293d074"
    };
  </script>
  
  <!-- é«˜å¾·åœ°å›¾API -->
  <script src="https://webapi.amap.com/loader.js"></script>
  
  <!-- ä¸»åº”ç”¨è„šæœ¬ -->
  <script type="text/javascript">
    const CONFIG = {
      amapKey: "1449516df803bfda88c3e70143b5164a",
      campus: {
        name: "è¥¿å—æ—ä¸šå¤§å­¦ï¼ˆæ ¡æœ¬éƒ¨ï¼‰",
        center: [102.741568, 25.071623],
        zoom: 17,
        pitch: 45,
        rotation: 10,
        intro: `è¥¿å—æ—ä¸šå¤§å­¦ï¼ˆæ ¡æœ¬éƒ¨ï¼‰ä½äºäº‘å—çœæ˜†æ˜å¸‚ç›˜é¾™åŒºç™½é¾™å¯º300å·ï¼Œæ˜¯ä¸€æ‰€ä»¥æ—å­¦ä¸ºç‰¹è‰²çš„çœå±é‡ç‚¹å¤§å­¦ã€‚æ ¡å›­å åœ°çº¦1238äº©ï¼Œæ‹¥æœ‰å¤šæ ‹æ•™å­¦æ¥¼ã€é£Ÿå ‚ã€å›¾ä¹¦é¦†ã€ä½“è‚²é¦†ã€å®éªŒæ¥¼ç­‰å®Œå–„çš„æ•™å­¦ä¸ç”Ÿæ´»è®¾æ–½ï¼Œç»¿æ¤è¦†ç›–ç‡è¾¾80%ä»¥ä¸Šï¼Œç¯å¢ƒæ¸…å¹½ã€‚`,
        spots: [
          { id: 1, position: [102.740286, 25.072815], name: "æ•™å­¦ä¸»æ¥¼", type: "academic", desc: "å…¨æ ¡æ ¸å¿ƒæ•™å­¦åœ°æ ‡ï¼Œæ‰¿æ‹…ä¸»è¦ç†è®ºè¯¾ç¨‹æ•™å­¦", fullDesc: `ğŸ“Œ æ•™å­¦ä¸»æ¥¼ã€æ ¸å¿ƒæ•™å­¦æ¥¼ã€‘\nå…¨æ ¡æ ¸å¿ƒæ•™å­¦å»ºç­‘ï¼Œå…±12å±‚ï¼Œæ‰¿æ‹…å…¨æ ¡å„é™¢ç³»å…¬å…±å¿…ä¿®è¯¾ã€ä¸“ä¸šç†è®ºè¯¾æ•™å­¦ä»»åŠ¡ï¼Œæ˜¯æ ¡å†…è§„æ¨¡æœ€å¤§çš„æ•™å­¦æ¥¼ã€‚\nâœ… é…å¥—ï¼š86é—´å¤šåª’ä½“æ•™å®¤ã€3ä¸ªé˜¶æ¢¯æŠ¥å‘Šå…ã€æ¯å±‚è®¾è‡ªä¹ åŒºä¸ç›´é¥®æ°´ç‚¹ï¼Œä¸€æ¥¼è®¾æ•™åŠ¡æœåŠ¡ä¸­å¿ƒã€‚\nğŸ’¡ è´´å£«ï¼šæ—©æ™šè‡ªä¹ é«˜å³°åº§ä½ç´§å¼ ï¼ŒæœŸæœ«å¼€æ”¾è‡³22:30ï¼Œç”µæ¢¯åˆ†å•åŒå±‚è¿è¡Œæ•ˆç‡æ›´é«˜ã€‚` },
          { id: 2, position: [102.739124, 25.073126], name: "ç¬¬ä¸€æ•™å­¦æ¥¼", type: "academic", desc: "åŸºç¡€å­¦ç§‘æ•™å­¦æ¥¼ï¼Œä»¥æ–‡ç†è¯¾ç¨‹ä¸ºä¸»", fullDesc: `ğŸ“Œ ç¬¬ä¸€æ•™å­¦æ¥¼ã€åŸºç¡€å­¦ç§‘æ¥¼ã€‘\næ ¡å†…åŸºç¡€è¯¾ç¨‹æ ¸å¿ƒæ•™å­¦æ¥¼ï¼Œå…±6å±‚ï¼Œä¸»è¦æ‰¿æ‹…é«˜æ•°ã€è‹±è¯­ã€è®¡ç®—æœºã€æ€æ”¿ç­‰å…¬å…±åŸºç¡€è¯¾ç¨‹æ•™å­¦ã€‚\nâœ… é…å¥—ï¼šæ ‡å‡†åŒ–æ•™å®¤42é—´ï¼Œå…¨éƒ¨é…å¤‡å¤šåª’ä½“è®¾å¤‡ä¸ç©ºè°ƒï¼Œä¸€æ¥¼è®¾æ‰“å°åº—ä¸é¥®æ°´åŒºã€‚\nğŸ’¡ è´´å£«ï¼šæ•™å®¤åˆ†å¸ƒé›†ä¸­ï¼Œä¸Šè¯¾é«˜å³°æœŸäººæµé‡å¤§ï¼Œå»ºè®®æå‰5åˆ†é’Ÿåˆ°è¾¾ã€‚` },
          { id: 3, position: [102.742157, 25.073568], name: "ç¬¬äºŒæ•™å­¦æ¥¼", type: "academic", desc: "ä¸“ä¸šæ•™å­¦æ¥¼ï¼Œä»¥æ—å­¦ã€å›­æ—ç›¸å…³è¯¾ç¨‹ä¸ºä¸»", fullDesc: `ğŸ“Œ ç¬¬äºŒæ•™å­¦æ¥¼ã€æ—å­¦ä¸“ä¸šæ¥¼ã€‘\nè´´åˆå­¦æ ¡ç‰¹è‰²çš„ä¸“ä¸šæ•™å­¦æ¥¼ï¼Œå…±7å±‚ï¼Œä¸»è¦æ‰¿æ‹…æ—å­¦ã€å›­æ—ã€ç”Ÿæ€å­¦ã€æ°´åœŸä¿æŒç­‰ä¸“ä¸šè¯¾æ•™å­¦ã€‚\nâœ… é…å¥—ï¼šä¸“ä¸šå¤šåª’ä½“æ•™å®¤ã€å°å‹ç ”è®¨å®¤ã€è¯¾ç¨‹è®¾è®¡æ•™å®¤ï¼Œéƒ¨åˆ†æ•™å®¤é…å¤‡ä¸“ä¸šå®éªŒè®¾å¤‡ã€‚\nğŸ’¡ è´´å£«ï¼šç¦»å®éªŒæ¥¼è¾ƒè¿‘ï¼Œä¸“ä¸šè¯¾å®éªŒå¯å°±è¿‘ä¸Šè¯¾ï¼Œè‡ªä¹ åŒºè¾ƒå°‘å»ºè®®å»å›¾ä¹¦é¦†ã€‚` },
          { id: 4, position: [102.743521, 25.071896], name: "ç¬¬ä¸‰æ•™å­¦æ¥¼", type: "academic", desc: "ç»¼åˆæ•™å­¦æ¥¼ï¼Œä»¥ç»ç®¡ã€æ–‡æ³•ç±»è¯¾ç¨‹ä¸ºä¸»", fullDesc: `ğŸ“Œ ç¬¬ä¸‰æ•™å­¦æ¥¼ã€ç»¼åˆæ–‡ç§‘æ¥¼ã€‘\næ ¡å†…æ–‡ç§‘ç±»ç»¼åˆæ•™å­¦æ¥¼ï¼Œå…±5å±‚ï¼Œä¸»è¦æ‰¿æ‹…ç»ç®¡ã€æ–‡æ³•ã€å¤–è¯­ã€è‰ºæœ¯ç±»è¯¾ç¨‹æ•™å­¦ã€‚\nâœ… é…å¥—ï¼šå¤šåª’ä½“æ•™å®¤35é—´ï¼Œè¯­éŸ³æ•™å®¤6é—´ï¼Œç”»å®¤2é—´ï¼Œç¯å¢ƒå®‰é™é€‚åˆæ–‡ç§‘å­¦ä¹ ã€‚\nğŸ’¡ è´´å£«ï¼šç¦»åŒ—è‹‘é£Ÿå ‚è¿‘ï¼Œä¸‹è¯¾å°±é¤æ–¹ä¾¿ï¼Œè‡ªä¹ åº§ä½å……è¶³é€‚åˆæ—¥å¸¸è‡ªä¹ ã€‚` },
          { id: 5, position: [102.738569, 25.070258], name: "å®è®­æ•™å­¦æ¥¼", type: "academic", desc: "å®è·µæ•™å­¦ä¸ºä¸»ï¼Œå«æœºæˆ¿ã€å®è®­æ•™å®¤", fullDesc: `ğŸ“Œ å®è®­æ•™å­¦æ¥¼ã€å®è·µæ•™å­¦æ¥¼ã€‘\næ ¡å†…å®è·µè¯¾ç¨‹æ ¸å¿ƒæ¥¼ï¼Œå…±8å±‚ï¼Œä¸»è¦æ‰¿æ‹…è®¡ç®—æœºå®è®­ã€æµ‹ç»˜å®è®­ã€ä¸“ä¸šè½¯ä»¶æ“ä½œç­‰å®è·µè¯¾ç¨‹ã€‚\nâœ… é…å¥—ï¼šè®¡ç®—æœºæœºæˆ¿6é—´ã€æµ‹ç»˜å®è®­å®¤3é—´ã€ç”µå·¥ç”µå­å®è®­å®¤2é—´ï¼Œè®¾å¤‡å®šæœŸæ›´æ–°ã€‚\nğŸ’¡ è´´å£«ï¼šä¸Šæœºè¯¾éœ€æå‰é¢„çº¦æœºä½ï¼Œå®è®­è¯¾ç¨‹è¾ƒå¤šï¼Œå»ºè®®å¸¦Uç›˜å­˜å‚¨ä½œä¸šã€‚` },
          { id: 6, position: [102.742891, 25.070582], name: "ä¸»å›¾ä¹¦é¦†", type: "library", desc: "æ ¡å†…æ ¸å¿ƒå›¾ä¹¦é¦†ï¼Œé¦†è—ç™¾ä¸‡å†Œå„ç±»å›¾ä¹¦æ–‡çŒ®", fullDesc: `ğŸ“Œ ä¸»å›¾ä¹¦é¦†ã€æ ¸å¿ƒé¦†è—é¦†ã€‘\näº‘å—çœæ—ä¸šç±»æ–‡çŒ®æœ€é½å…¨çš„å›¾ä¹¦é¦†ï¼Œæ€»å»ºç­‘é¢ç§¯1.8ä¸‡ã¡ï¼Œé¦†è—çº¸è´¨å›¾ä¹¦130ä½™ä¸‡å†Œï¼Œç”µå­æ–‡çŒ®200ä½™ä¸‡ç¯‡ï¼Œä¸»æ‰“æ—å­¦ç‰¹è‰²é¦†è—ã€‚\nâœ… é…å¥—ï¼šå€Ÿé˜…å¤§å…ã€å›¾ä¹¦é˜…è§ˆåŒºã€è€ƒç ”è‡ªä¹ åŒºã€ç”µå­é˜…è§ˆå®¤ã€å­¦æœ¯ç ”è®¨å®¤ï¼Œæ”¯æŒæ ¡å›­å¡å€Ÿé˜…ä¸çº¿ä¸Šé¢„çº¦ã€‚\nğŸ’¡ è´´å£«ï¼šéœ€åˆ·å¡å…¥é¦†ï¼Œè€ƒç ”åº§ä½æå‰é¢„çº¦ï¼Œå‘¨äº”ä¸‹åˆé—­é¦†æ•´ç†ï¼Œæ—¥å¸¸é—­é¦†æ—¶é—´22:00ã€‚` },
          { id: 7, position: [102.741856, 25.072135], name: "æ—ä¸šä¸“ä¸šåˆ†é¦†", type: "library", desc: "æ—å­¦ä¸“ä¸šç‰¹è‰²å›¾ä¹¦é¦†ï¼Œé¦†è—ä¸“ä¸šæ–‡çŒ®èµ„æ–™", fullDesc: `ğŸ“Œ æ—ä¸šä¸“ä¸šåˆ†é¦†ã€ç‰¹è‰²é¦†è—é¦†ã€‘\næ ¡å†…æ—å­¦ä¸“ä¸šä¸“å±å›¾ä¹¦é¦†ï¼Œå…±3å±‚ï¼Œé¦†è—æ—ä¸šã€å›­æ—ã€æ£®ä¿ã€æœ¨æç§‘å­¦ç­‰ä¸“ä¸šå›¾ä¹¦ä¸æ–‡çŒ®ï¼Œæ˜¯ä¸“ä¸šè¯¾å­¦ä¹ çš„æ ¸å¿ƒé˜µåœ°ã€‚\nâœ… é…å¥—ï¼šä¸“ä¸šé˜…è§ˆåŒºã€æ–‡çŒ®æ£€ç´¢å®¤ã€æ ‡æœ¬å±•ç¤ºåŒºï¼Œé¦†è—çç¨€æ—æœ¨æ ‡æœ¬è¶…åƒä»½ï¼Œå¯æŸ¥é˜…ä¸“ä¸šå¤–æ–‡æ–‡çŒ®ã€‚\nğŸ’¡ è´´å£«ï¼šäººæµé‡è¾ƒå°‘ï¼Œä¸“ä¸šèµ„æ–™é½å…¨ï¼Œé€‚åˆä¸“ä¸šè¯¾å¤ä¹ ä¸è®ºæ–‡æŸ¥é˜…ï¼Œå¼€æ”¾æ—¶é—´8:00-21:00ã€‚` },
          { id: 8, position: [102.739876, 25.070129], name: "å—è‹‘å­¦ç”Ÿé£Ÿå ‚", type: "dining", desc: "æ ¡å†…æ ¸å¿ƒé£Ÿå ‚ï¼Œèœå“ä¸°å¯Œï¼Œæ€§ä»·æ¯”é«˜", fullDesc: `ğŸ“Œ å—è‹‘å­¦ç”Ÿé£Ÿå ‚ã€æ ¸å¿ƒé¤é¥®ä¸­å¿ƒã€‘\næ ¡æœ¬éƒ¨æœ€å¤§é£Ÿå ‚ï¼Œå…±3å±‚å¯å®¹çº³2000ä½™äººå°±é¤ï¼Œèœå“å…¼é¡¾å—åŒ—å£å‘³ä¸äº‘å—æ°‘æ—ç‰¹è‰²ï¼Œæ˜¯å¸ˆç”Ÿå°±é¤é¦–é€‰ã€‚\nâœ… é…å¥—ï¼š1æ¥¼å¤§ä¼—å¿«é¤ã€2æ¥¼ç‰¹è‰²é£å‘³ã€3æ¥¼èšé¤å¥—é¤ï¼Œæ”¯æŒæ ¡å›­å¡ä¸ç§»åŠ¨æ”¯ä»˜ï¼Œé¤å…·æ¯æ—¥æ¶ˆæ¯’ã€‚\nğŸ’¡ è´´å£«ï¼šåˆé¤é«˜å³°11:30-12:30ï¼Œæ™šé¤17:30-18:30ï¼Œ3æ¥¼ç¯å¢ƒå¥½é”™å³°å°±é¤ä½“éªŒæ›´ä½³ã€‚` },
          { id: 9, position: [102.743258, 25.073269], name: "åŒ—è‹‘é£Ÿå ‚", type: "dining", desc: "é£å‘³é£Ÿå ‚ï¼Œä¸»æ‰“ç‰¹è‰²å°åƒä¸åœ°æ–¹ç¾é£Ÿ", fullDesc: `ğŸ“Œ åŒ—è‹‘é£Ÿå ‚ã€ç‰¹è‰²é£å‘³é£Ÿå ‚ã€‘\næ ¡å†…ç‰¹è‰²å°åƒé£Ÿå ‚ï¼Œå…±2å±‚ï¼Œä¸»æ‰“äº‘å—ç±³çº¿ã€é¢æ¡ã€ç‚’é¥­ã€ç‚¸é¸¡æ±‰å ¡ã€éº»è¾£é¦™é”…ç­‰ç‰¹è‰²ç¾é£Ÿï¼Œå£å‘³å¤šæ ·ã€‚\nâœ… é…å¥—ï¼šç‰¹è‰²çª—å£15ä¸ªï¼Œæ—©é¤ç§ç±»ä¸°å¯Œï¼Œå¤œå®µå¼€æ”¾è‡³21:30ï¼Œæ”¯æŒç§»åŠ¨æ”¯ä»˜ï¼Œä»·æ ¼å®æƒ ã€‚\nğŸ’¡ è´´å£«ï¼šç¦»ç¬¬ä¸‰æ•™å­¦æ¥¼ä¸ä½“è‚²é¦†è¿‘ï¼Œè¿åŠ¨åå°±é¤æ–¹ä¾¿ï¼Œå°åƒåˆ†é‡è¶³æ€§ä»·æ¯”é«˜ã€‚` },
          { id: 10, position: [102.740635, 25.071589], name: "æ¸…çœŸé£Ÿå ‚", type: "dining", desc: "æ¸…çœŸç‰¹è‰²é£Ÿå ‚ï¼Œèœå“ç¬¦åˆæ¸…çœŸé¥®é£Ÿæ ‡å‡†", fullDesc: `ğŸ“Œ æ¸…çœŸé£Ÿå ‚ã€æ°‘æ—ç‰¹è‰²é£Ÿå ‚ã€‘\næ ¡å†…æ¸…çœŸä¸“å±é£Ÿå ‚ï¼Œå…±2å±‚ï¼Œèœå“ä¸¥æ ¼éµå¾ªæ¸…çœŸé¥®é£Ÿæ ‡å‡†ï¼Œä¸»æ‰“æ¸…çœŸå¿«é¤ã€ç‰›è‚‰é¢ã€æ‰‹æŠ“é¥­ã€çƒ¤åŒ…å­ç­‰ã€‚\nâœ… é…å¥—ï¼šèœå“å¹²å‡€å«ç”Ÿï¼Œåˆ†é‡å……è¶³ï¼Œä»·æ ¼äº²æ°‘ï¼Œå…¼é¡¾æ°‘æ—é¥®é£Ÿéœ€æ±‚ï¼Œæ”¯æŒæ ¡å›­å¡ä¸ç§»åŠ¨æ”¯ä»˜ã€‚\nğŸ’¡ è´´å£«ï¼šå°±é¤äººæ•°é€‚ä¸­ï¼Œæ— éœ€æ’é˜Ÿï¼Œç¦»æ•™å­¦ä¸»æ¥¼è¿‘ï¼Œè¯¾é—´å°±é¤æ–¹ä¾¿å¿«æ·ã€‚` },
          { id: 11, position: [102.738256, 25.071236], name: "æ•™å·¥é£Ÿå ‚", type: "dining", desc: "æ•™èŒå·¥é£Ÿå ‚ï¼Œèœå“ç²¾è‡´ï¼Œç¯å¢ƒå®‰é™", fullDesc: `ğŸ“Œ æ•™å·¥é£Ÿå ‚ã€ç²¾è‡´ä¾¿æ·é£Ÿå ‚ã€‘\næ ¡å†…æ•™èŒå·¥ä¸“å±é£Ÿå ‚ï¼Œå¯¹å¤–å¼€æ”¾ï¼Œå…±1å±‚ï¼Œèœå“ç²¾è‡´å°‘æ²¹å°‘ç›ï¼Œä¸»æ‰“å®¶å¸¸èœä¸è¥å…»é¤ï¼Œç§ç±»ä¸å¤šä½†å“è´¨é«˜ã€‚\nâœ… é…å¥—ï¼šå°±é¤ç¯å¢ƒå®‰é™ï¼Œåº§ä½å®½æ•ï¼Œæ—©é¤æœ‰åŒ…å­è±†æµ†æ²¹æ¡ï¼Œåˆé¤æ™šé¤ä¸ºå¥—é¤å½¢å¼ï¼Œæ”¯æŒæ‰«ç æ”¯ä»˜ã€‚\nğŸ’¡ è´´å£«ï¼šäººæµé‡å°‘æ— éœ€æ’é˜Ÿï¼Œé€‚åˆå–œæ¬¢å®‰é™å°±é¤çš„åŒå­¦ï¼Œä»·æ ¼ç•¥é«˜äºå­¦ç”Ÿé£Ÿå ‚ã€‚` },
          { id: 12, position: [102.743567, 25.072148], name: "ä½“è‚²é¦†", type: "sports", desc: "ç»¼åˆä½“è‚²åœºé¦†ï¼Œå«ç¯®çƒã€ç¾½æ¯›çƒã€å¥èº«åŒº", fullDesc: `ğŸ“Œ ä½“è‚²é¦†ã€ç»¼åˆä½“è‚²ä¸­å¿ƒã€‘\næ ¡å†…æ ‡å‡†åŒ–ä½“è‚²åœºé¦†ï¼Œåˆ†å®¤å†…ä¸»é¦†ä¸å®¤å¤–åœºåœ°ï¼Œæ‰¿æ‹…ä½“è‚²æ•™å­¦ã€æ ¡é˜Ÿè®­ç»ƒä¸æ ¡å›­æ–‡ä½“æ´»åŠ¨ã€‚\nâœ… é…å¥—ï¼šå®¤å†…ç¯®çƒåœº2ä¸ªã€ç¾½æ¯›çƒåœº8ä¸ªã€ä¹’ä¹“çƒå°12å¼ ã€å¥èº«æˆ¿ä¸å½¢ä½“æ•™å®¤ï¼Œå®¤å¤–å¡‘èƒ¶è·‘é“ä¸æ’çƒåœºã€‚\nğŸ’¡ è´´å£«ï¼šè¯¾ä½™æ—¶é—´å…è´¹å¼€æ”¾ï¼Œå™¨æå¯ç™»è®°ç§Ÿå€Ÿï¼Œå‘¨æœ«äººæµé‡å¤§å»ºè®®é”™å³°ä½¿ç”¨ï¼Œç¦æ­¢ç©¿é«˜è·Ÿé‹å…¥åœºã€‚` },
          { id: 13, position: [102.741234, 25.071001], name: "å®éªŒæ¥¼", type: "laboratory", desc: "æ—ä¸šä¸“ä¸šå®éªŒæ¥¼ï¼Œé…å¤‡å®Œå–„ç§‘ç ”å®éªŒè®¾å¤‡", fullDesc: `ğŸ“Œ å®éªŒæ¥¼ã€æ—ä¸šç§‘ç ”åŸºåœ°ã€‘\næ ¡å†…æ ¸å¿ƒå®éªŒæ•™å­¦å»ºç­‘ï¼Œå…±8å±‚ï¼Œæ‰¿æ‹…æ—å­¦ã€å›­æ—ã€ç”Ÿç‰©æŠ€æœ¯ç­‰ä¸“ä¸šå®éªŒè¯¾ç¨‹ä¸ç§‘ç ”é¡¹ç›®ã€‚\nâœ… é…å¥—ï¼šæ¤ç‰©æ ‡æœ¬å®¤ã€åœŸå£¤æ£€æµ‹å®¤ã€æ—æœ¨è‚²ç§å®¤ã€ç”Ÿæ€ç›‘æµ‹å®¤ï¼Œæ¯å±‚æœ‰å®éªŒæŒ‡å¯¼è€å¸ˆå€¼ç­ï¼Œè®¾å¤‡å…ˆè¿›ã€‚\nğŸ’¡ è´´å£«ï¼šè¿›å…¥éœ€ç©¿å®éªŒæœï¼Œéƒ¨åˆ†å®éªŒå®¤éœ€æå‰é¢„çº¦ï¼Œä¸¥æ ¼éµå®ˆå®éªŒå®‰å…¨è§„èŒƒï¼Œå™¨æç¦æ­¢ç§è‡ªå¸¦å‡ºã€‚` }
        ]
      }
    };

    class SmartCampusMap {
      constructor() {
        this.map = null;
        this.AMap = null;
        this.markers = [];
        this.infoWindows = [];
        this.routeLayers = [];
        this.currentRouteType = 'drive';
        this.startPoint = null;
        this.startMarker = null;
        this.normalIcon = null;
        this.startIcon = null;
        this.planIsOpen = false;
        this.planTipsEl = document.getElementById('planTips');
      }

      async init() {
        try {
          this.AMap = await AMapLoader.load({
            key: CONFIG.amapKey,
            version: "2.0",
            plugins: ['AMap.ToolBar', 'AMap.Scale', 'AMap.HawkEye', 'AMap.MapType','AMap.InfoWindow', 'AMap.Geolocation','AMap.Walking', 'AMap.Riding', 'AMap.Driving']
          });

          this.map = new this.AMap.Map("container", {
            viewMode: '3D',
            zoom: CONFIG.campus.zoom,
            center: CONFIG.campus.center,
            pitch: CONFIG.campus.pitch,
            rotation: CONFIG.campus.rotation,
            mapStyle: 'amap://styles/light'
          });

          this.initIcons();
          this.addLayers();
          this.addControls();
          this.addMarkers();
          this.updateSidebar();
          this.hideLoading();
          this.adjustView();
          this.bindRouteEvents();
          this.bindPlanSwitchEvent();
        } catch (error) {
          console.error('âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
          this.showError('åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥');
        }
      }

      initIcons() {
        this.normalIcon = new this.AMap.Icon({ size: new this.AMap.Size(40, 48), image: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png", imageSize: new this.AMap.Size(40, 48), anchor: 'bottom-center' });
        this.startIcon = new this.AMap.Icon({ size: new this.AMap.Size(46, 55), image: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png", imageSize: new this.AMap.Size(46, 55), anchor: 'bottom-center' });
      }

      addLayers() {
        this.map.add([new this.AMap.TileLayer.Traffic({ autoRefresh: true }),new this.AMap.Buildings({ heightFactor: 1.2 }),new this.AMap.TileLayer.Satellite(),new this.AMap.TileLayer.RoadNet()]);
      }

      addControls() {
        this.map.addControl(new this.AMap.ToolBar({ position: 'RT' }));
        this.map.addControl(new this.AMap.Scale({ position: 'LB' }));
        this.map.addControl(new this.AMap.HawkEye({ isOpen: true, position: 'RB' }));
        this.map.addControl(new this.AMap.MapType({ defaultType: 0, position: 'RT' }));
        this.map.addControl(new this.AMap.Geolocation({ position: 'LB', showCircle: false }));
      }

      addMarkers() {
        const { spots } = CONFIG.campus;
        const _this = this;
        const mainMarker = new this.AMap.Marker({ position: CONFIG.campus.center, icon: this.normalIcon, anchor: 'bottom-center', zIndex: 100 });
        const mainInfoWindow = new this.AMap.InfoWindow({ content: this.getCampusInfoContent(), offset: new this.AMap.Pixel(0, -100), closeWhenClickMap: true });
        mainMarker.on('click', function() { _this.closeAllInfoWindows(); mainInfoWindow.open(_this.map, CONFIG.campus.center); _this.infoWindows.push(mainInfoWindow); });
        this.map.add(mainMarker);this.markers.push(mainMarker);

        spots.forEach(spot => {
          const marker = new this.AMap.Marker({ position: spot.position, icon: this.normalIcon, anchor: 'bottom-center', title: spot.name, extData: spot, zIndex: 90 });
          const infoWindow = new this.AMap.InfoWindow({ content: this.getSpotInfoContent(spot), offset: new this.AMap.Pixel(0, -60), closeWhenClickMap: true });
          marker.on('click', function() {
            _this.closeAllInfoWindows();infoWindow.open(_this.map, spot.position);_this.infoWindows.push(infoWindow);_this.map.setCenter(spot.position);_this.map.setZoom(18);
            if (_this.planIsOpen) {
              if (_this.startPoint === null) {_this.startPoint = spot;_this.startMarker = marker;marker.setIcon(_this.startIcon);}
              else if (_this.startPoint.id === spot.id) {_this.startPoint = null;marker.setIcon(_this.normalIcon);}
              else {const endPoint = spot;_this.searchRoute(_this.startPoint.position, endPoint.position);_this.startMarker.setIcon(_this.normalIcon);_this.startPoint = null;_this.startMarker = null;}
            }
          });
          this.map.add(marker);this.markers.push(marker);
        });
      }

      getCampusInfoContent() {
        return `<div style="width: 320px; padding: 15px;"><h3 style="color: #009688; margin: 0 0 10px 0; font-size: 16px;">${CONFIG.campus.name}</h3><p style="margin: 0; color: #666; line-height: 1.7; font-size: 14px; white-space: pre-line;">${CONFIG.campus.intro}<br/><br/>ğŸ“ æ ¡åŒºç‰¹è‰²ï¼šä¾å±±è€Œå»ºï¼ŒåŸç”Ÿæ—æœ¨è¦†ç›–ç‡é«˜ï¼Œæ•™å­¦ä¸ç”Ÿæ´»è®¾æ–½å®Œå–„ï¼Œæ˜¯é›†å­¦ä¹ ã€ç§‘ç ”ã€ç”Ÿæ´»äºä¸€ä½“çš„ç”Ÿæ€æ ¡å›­ã€‚<br/>ğŸ“š åŠå­¦ä¼˜åŠ¿ï¼šæ—å­¦ã€é£æ™¯å›­æ—ä¸ºå›½å®¶çº§ç‰¹è‰²ä¸“ä¸šï¼Œæ‹¥æœ‰å¤šä¸ªçœçº§æ—ä¸šç§‘ç ”å¹³å°ä¸å®è·µåŸºåœ°ã€‚</p></div>`;
      }

      getSpotInfoContent(spot) {
        return `<div style="width: 340px; padding: 15px; border-radius: 8px;"><h4 style="color: #009688; margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">${spot.name}</h4><p style="margin: 0; color: #333; line-height: 1.7; font-size: 14px; white-space: pre-line;">${spot.fullDesc}</p><div style="margin-top:12px;font-size:12px;color:#888;text-align:right;">ç‚¹å‡»åœ°å›¾ç©ºç™½å¤„å…³é—­çª—å£</div></div>`;
      }

      closeAllInfoWindows() {this.infoWindows.forEach(window => window.close());this.infoWindows = [];}
      updateSidebar() {
        document.getElementById('campus-intro').textContent = CONFIG.campus.intro.replace(/\n/g, ' ');
        document.getElementById('spot-list').innerHTML = CONFIG.campus.spots.map(spot => `<div class="spot-item" onclick="campusMap.flyToSpot(${spot.id})"><strong>${spot.name}</strong><p>${spot.desc.substring(0, 40)}...</p></div>`).join('');
      }
      flyToSpot(spotId) {const spot = CONFIG.campus.spots.find(s => s.id === spotId);if(spot){this.map.setCenter(spot.position);this.map.setZoom(18);const marker = this.markers.find(m => m.getExtData()?.id === spotId);marker && marker.emit('click');}}
      adjustView() {if(this.markers.length>0)this.map.setFitView(this.markers, false, [80,80,80,80]);}
      hideLoading() {document.getElementById('loading').style.display = 'none';}
      showError(message) {document.getElementById('loading').innerHTML = `<div style="text-align:center;color:#f44336;"><div style="font-size:48px;margin-bottom:20px;">âš ï¸</div><h3>åŠ è½½å¤±è´¥</h3><p>${message}</p><button onclick="location.reload()" style="margin-top:20px;padding:10px20px;background:#009688;color:white;border:none;border-radius:5px;cursor:pointer;">é‡æ–°åŠ è½½</button></div>`;}

      bindPlanSwitchEvent() {
        const _this = this;const switchBtn = document.getElementById('planSwitch');
        switchBtn.addEventListener('click', function() {
          if (_this.planIsOpen) {_this.planIsOpen=false;switchBtn.classList.remove('open');switchBtn.innerText='å¼€å¯è·¯å¾„è§„åˆ’';_this.planTipsEl.innerHTML='âœ… è·¯å¾„è§„åˆ’åŠŸèƒ½å·²å…³é—­ â†’ ä»…å¯æŸ¥çœ‹åœ°å›¾ç‚¹ä½ä¿¡æ¯ï¼Œæ— è·¯çº¿è§„åˆ’åŠŸèƒ½';_this.clearRouteLayer();if(_this.startMarker)_this.startMarker.setIcon(_this.normalIcon);_this.startPoint=null;_this.startMarker=null;}
          else {_this.planIsOpen=true;switchBtn.classList.add('open');switchBtn.innerText='å…³é—­è·¯å¾„è§„åˆ’';_this.planTipsEl.innerHTML='ğŸŸ¢ è·¯å¾„è§„åˆ’åŠŸèƒ½å·²å¼€å¯ â†’ ç‚¹å‡»åœ°å›¾ä¸Šçš„ç‚¹ä½ï¼Œç¬¬ä¸€ä¸ªä¸ºèµ·ç‚¹ï¼Œç¬¬äºŒä¸ªè‡ªåŠ¨è§„åˆ’è·¯çº¿ï¼ˆPSï¼šè·¯å¾„è§„åˆ’ç”±äºè·ç¦»åŸå› ä¸æ˜¯å¾ˆå®Œå–„ï¼‰';}
        });
      }

      bindRouteEvents() {
        const _this = this;const btns = document.querySelectorAll('.route-btn');
        btns.forEach(btn => {btn.addEventListener('click', (e) => {if(!_this.planIsOpen)return;btns.forEach(b=>b.classList.remove('active'));e.target.classList.add('active');_this.currentRouteType=e.target.dataset.type;if(_this.startPoint){const start=_this.startPoint.position;const currentCenter=_this.map.getCenter();_this.clearRouteLayer();_this.searchRoute(start,currentCenter);}})});
        document.getElementById('clearRoute').addEventListener('click', () => {_this.clearRouteLayer();if(_this.startMarker)_this.startMarker.setIcon(_this.normalIcon);_this.startPoint=null;_this.startMarker=null;});
      }

      clearRouteLayer() {this.routeLayers.forEach(layer => this.map.remove(layer));this.routeLayers = [];}
      searchRoute(start, end) {
        this.clearRouteLayer();let planner = null;const _this = this;
        switch (this.currentRouteType) {
          case 'walk': planner = new this.AMap.Walking({map: this.map,policy: this.AMap.WalkingPolicy.LEAST_DISTANCE,avoidRoad: true,showTraffic: false});break;
          case 'ride': planner = new this.AMap.Riding({map: this.map,policy: this.AMap.RidingPolicy.LEAST_TIME});break;
          case 'drive': planner = new this.AMap.Driving({map: this.map,policy: this.AMap.DrivingPolicy.LEAST_TIME});break;
        }
        planner.search([{ location: start }, { location: end }], (status, result) => {
          if (status === 'complete' && result.routes && result.routes.length > 0) {
            const route = result.routes[0];let pathStyle = {};
            if(_this.currentRouteType === 'walk'){
                pathStyle = {path: route.path,strokeColor: _this.getRouteColor(),strokeWeight:6,strokeOpacity:0.9,strokeStyle:'solid',borderWeight:2,zIndex:999,lineJoin:'round',lineCap:'round',strokeDasharray:[]};
            }else{
                pathStyle = {path: route.path,strokeColor: _this.getRouteColor(),strokeWeight:8,strokeOpacity:0.85,strokeStyle:'solid',borderWeight:1,zIndex:999,lineJoin:'round',lineCap:'round'};
            }
            const path = new this.AMap.Polyline(pathStyle);_this.map.add(path);_this.routeLayers.push(path);_this.map.setFitView(_this.routeLayers.concat(_this.markers), false, [50,50,50,50]);_this.map.setZoom(18);
          } else {
            let failColor = "#ff6666";if(_this.currentRouteType === 'walk') failColor = "#009688";
            const directLine = new this.AMap.Polyline({path: [start, end],strokeColor: failColor,strokeWeight: _this.currentRouteType === 'walk' ?5:6,strokeOpacity:0.7,strokeStyle:"dashed",zIndex:999,lineJoin:'round',lineCap:'round'});
            _this.map.add(directLine);_this.routeLayers.push(directLine);_this.map.setFitView([start, end], false, [30,30,30,30]);
          }
        });
      }
      getRouteColor() {const colors={walk:'#009688',ride:'#1e88e5',drive:'#f44336'};return colors[this.currentRouteType]||'#009688';}
    }

    let campusMap;
    document.addEventListener('DOMContentLoaded', () => {campusMap = new SmartCampusMap();campusMap.init();window.campusMap = campusMap;});
    window.addEventListener('resize', () => {if(campusMap && campusMap.map)campusMap.map.setFitView(campusMap.markers, false, [80,80,80,80]);});
  </script>
</body>
</html>